---
title: Алгоритм изменения унаследованного кода
date of creation: 2025-04-21T01:43:00
tags:
  - Algorithm
  - Base
  - Refactoring
read status: true
completion status: true
aliases:
---
# Алгоритм изменения унаследованного кода
---

В своей книге Working Effectively with Legacy Code (Pearson, 2004) Майкл К. Физерс предлагает следующие этапы безопасного изменения существующих кодовых баз.

1. Определение точек изменения.
2. Нахождение тестовых точек.
3. Разрывание зависимостей.
4. Написание тестов.
5. Внесение изменений и рефакторинг кода.

==Думайте о первых четырех этапах как о расчистке земли и установке забора вокруг поля перед посадкой семян, которая будет выполнена на пятом этапе.== Если вы не установите забор, на поле могут забрести дикие животные и выкопать высаженные вами растения. Найдите код, требующий изменения, и подумайте, как его можно протестировать. При необходимости выполните рефакторинг, чтобы сделать тестирование возможным. Добавьте тесты, подтверждающие существующее поведение. После установки забора, защищающего территорию вокруг выбранных точек, можете приступать к внесению соответствующих изменений.

==Рефакторинг, выполняемый с целью разрывания зависимостей, — самая рискованная часть работы.== Он может даже предполагать изменение уже существующих тестов, что затруднит выявление изменений в поведении. Действуйте осторожно и на данном этапе не внедряйте никаких новых функций. Убедитесь в том, что можете проводить тесты быстро: это позволит вам выполнять их достаточно часто.

Существует множество методов разрывания зависимостей, в том числе такие:

- ***разделение большого сложного метода на несколько более мелких с целью независимого тестирования отдельных фрагментов функциональности;***
- ***использование интерфейса (или другого посредника), позволяющего тестам предоставлять простую реализацию сложного объекта — неполную, но достаточную для тестирования;***
- ***внедрение явных контрольных точек, позволяющих имитировать трудно контролируемые аспекты выполнения, например течение времени.***

Не меняйте модификаторы доступа для упрощения тестов. Если вы сделаете общедоступными приватные методы и переменные, это, конечно, позволит тестам получить доступ к коду, но нарушит инкапсуляцию, так что такой обходной путь не назовешь удачным. Нарушение инкапсуляции увеличивает количество вариантов поведения, которые вы должны гарантировать в течение всего жизненного цикла проекта.

В процессе рефакторинга и разрывания зависимостей следует добавлять новые тесты для проверки старого поведения. Старайтесь как можно чаще запускать набор тестов, включающий как новые, так и старые тесты.

Рассмотрите возможность применения инструментов для автоматизированного тестирования с целью создания тестов, покрывающих существующее поведение.

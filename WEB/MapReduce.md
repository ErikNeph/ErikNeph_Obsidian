---
title: MapReduce
date of creation: 2025-10-15T20:07:00
tags:
  - Web
  - IT/Terminology
  - Terminology
  - Web/Terminology
  - Database
  - SQL
  - NoSQL
read status: true
completion status: true
aliases:
  - mapreduce
  - mapReduce
  - MAPREDUCE
  - Mapreduce
---
# MapReduce
---

**MapReduce** — ==модель программирования для обработки больших объемов данных блоками на множестве машин, активно продвигаемая компанией== [[Google]]. В ограниченном виде MapReduce поддерживается некоторыми [[NoSQL]]-хранилищами, включая [[MongoDB]] и [[CouchDB]] в качестве механизма выполняющих только чтение запросов по многим документам.

**MapReduce** — модель программирования довольно низкого уровня, предназначенная для распределенных вычислений на кластерах машин. Языки запросов более высокого уровня, такие как [[SQL]], можно реализовать в виде конвейера операций MapReduce, но существует также множество распределенных реализаций SQL, не использующих MapReduce. Обратите внимание: в языке SQL нет ничего, что бы запрещало его применение на отдельной машине, а у MapReduce нет монополии на распределенное выполнение запросов.

MapReduce не является ни декларативным языком запросов, ни полностью императивным API запросов. Это нечто среднее: логика запроса выражается с помощью фрагментов кода, которые используемый для обработки фреймворк вызывает многократно. Он основывается на функциях [[Функция map|map]] (известной также под названием collect) и [[Функция reduce|reduce]] (либо иначе `fold` или `inject`), существующих во многих функциональных языках программирования.

В качестве примера допустим, что вы морской биолог и каждый раз, когда видите в океане животных, вносите запись о наблюдении в свою базу данных. А теперь вам нужно сформировать отчет о количестве увиденных за месяц акул.

>В [[PostgreSQL]] этот запрос мог бы выглядеть примерно следующим образом:
```sql
SELECT date_trunc('month', 'observation_timestamp') AS observation_month,
                 sum(num_animals) AS total_animals
FROM obseravaions
WHERE family = 'Sharks'
GROUP BY observation_month;
```
>[!note]
Функция date_trunc('month', timestamp) определяет содержащий timestamp календарный месяц и возвращает другую метку даты/времени, соответствующую началу этого месяца. Другими словами, метка даты/времени округляется до ближайшего месяца.

Данный запрос сначала фильтрует наблюдения так, чтобы остались только виды, относящиеся к семейству Sharks, после чего группирует наблюдения по календарному месяцу и, наконец, суммирует количества наблюдавшихся в каждом из месяцев животных.

>Это же можно выразить с помощью представленной ниже возможности модели MapReduce базы данных MongoDB:
```MongoDB
db.observations.mapReduce(
	function map() {
		var year = this.observationTimestamp.getFullYear();
		var month = this.observationTimestamp.getMonth() + 1;
		emit(year + "-" + month, this.numAnimals);
	},
	function reduce(key, values) {
		return Array.sum(values);
	},
	{
		query: { family: "Sharks" },
		out: "monthlySharkRepo
	}
);
```

1) Фильтр, отсеивающий только акул, можно задать декларативным образом (это расширение MongoDB модели MapReduce).
2) JavaScript-функция map вызывается однократно для каждого документа, соответствующего `query`, где this соответствует объекту документа.
3) Функция `map` порождает ключ (строку, состоящую из года и месяца, например `"2013-12"` или `"2014-1"`) и значения (количества животных в данном наблюдении).
4) Порождаемые функцией map пары «ключ — значение» группируются по ключу. Для всех таких пар с одинаковым ключом (то есть с одним и тем же месяцем и годом) однократно вызывается функция `reduce`.
5) Функция `reduce` суммирует количество животных, наблюдавшихся в конкретном месяце.
6) Итоговые результаты записываются в коллекцию `monthlySharkReport`.

Например, пусть коллекция observations содержит следующие два документа:
```mongoDB
{
	observationTimestamp: Date.parse("Mon, 25 Dec 1995 12:34:56 GMT"),
	family: "Sharks",
	species: "Carcharodon carcharias", numAnimals: 3
}

{
	observationTimestamp: Date.parse("Tue, 12 Dec 1995 16:17:18 GMT"),
	family: "Sharks",
	species: "Carcharias taurus", numAnimals: 4
}
```

Функция `map` должна вызываться по разу для каждого документа, в результате чего вызывается `emit("1995-12", 3)` и `emit("1995-12", 4)`. Затем функция `reduce` будет вызвана с параметрами reduce`("1995-12", [3, 4])` и вернет `7`.

Разрешенные функциям `map` и `reduce` действия несколько ограничены. Эти функции должны быть *чистыми* (pure), то есть могут использовать только передаваемые в них входные данные, но не могут выполнять дополнительные запросы к БД и не должны иметь каких-либо побочных эффектов. Указанные ограничения позволяют базе выполнять эти функции где угодно, в любом порядке и повторно их запускать в случае неудачи. Тем не менее они обладают немалыми возможностями: способны производить синтаксический разбор строк, вызывать библиотечные функции, выполнять вычисления и др.


>Источник — [[Высоконагруженные приложения. Программирование, масштабирование, поддержка]]

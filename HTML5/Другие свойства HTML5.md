---
date of creation: 2024-07-15T16:24:00
tags:
  - HTML
  - HTML5
  - Properties
  - Web
  - Web/HTML
  - IT
  - IT/WEB
read status: false
aliases:
  - другие свойства HTML5
---
---
# Другие свойства HTML5


В этой последней главе из тех, что посвящены HTML5, будут рассмотрены вопросы использования геолокации, локального хранилища и продемонстрированы приемы перетаскивания. Также мы поговорим о том, как настраивать и использовать веб-процессы и задействовать обмен сообщениями между документами.

Строго говоря, большинство из этих свойств (как и многое другое в HTML5) реально не является расширениями HTML, поскольку доступ к ним осуществляется с помощью JavaScript, а не с помощью разметки HTML. Это просто технологии, которые были добавлены разработчиками браузеров и которым было дано общее удобное название HTML5.

Но это означает, что для их правильного применения вам нужно иметь полное представление о [[Изучение JavaScript|JavaScript]].


## Геолокация и служба GPS
---

[[GPS]] (Global Positioning System) состоит из множества спутников, находящихся на земной орбите, с точно известными позициями. Когда устройство, применяющее GPS, устанавливает связь со спутниками, различия во времени прихода сигналов от них позволяют устройству точно определить свое местоположение. Поскольку скорость света (а следовательно, и радиоволн) — известная постоянная величина, время, затрачиваемое сигналом на то, чтобы добраться от спутника до устройства GPS, показывает расстояние до этого спутника.

С учетом разной задержки сигналов от разных спутников, для которых имеются точные сведения об их орбитальном местоположении в любой заданный момент времени, простое триангуляционное вычисление дает устройству сведения о его позиции относительно спутников с точностью до нескольких метров или даже выше.

Во многих мобильных устройствах, таких как телефоны или планшетные компьютеры, имеются модули GPS, и они могут предоставить информацию о местоположении устройства. Но в одних устройствах таких чипов нет, в других они могут быть выключены, а третьи могут использоваться внутри помещений, будучи закрытыми от спутников GPS, и поэтому не смогут получать какие-либо сигналы. В таких случаях для попытки определения местоположения устройства можно применять дополнительные технологии.

>[!danger]
>Следует также предупредить о защите информации при применении геолокации, особенно если используемое приложение в рамках своей работы передает координаты вашего устройства на сервер. У любого приложения с функциями геолокации должна быть явно выраженная политика соблюдения конфиденциальности. Кстати, с технической точки зрения геолокация фактически не относится к стандарту HTML5. Это автономная функция, определенная консорциумом W3C/WHATWG, но по мнению большинства, она считается частью HTML5.


### Другие методы определения местоположения
---

Если ваше устройство подключено к мобильной сети, но не имеет встроенного GPS, его местоположение можно определить по сигналам, полученным от нескольких базовых станций (местоположение которых известно достаточно точно), с которыми устройство может обменяться данными.

Если есть несколько базовых станций, местоположение может быть получено почти с такой же точностью, как и от GPS. Но если станция только одна, то для определения приблизительного радиуса вокруг нее можно использовать уровень сигнала, а получившаяся окружность представит район, в котором вы, скорее всего, находитесь. Точность определения вашего местоположения будет варьировать от двух-трех километров до нескольких десятков метров.

При отсутствии и этой возможности вам помогут точки доступа Wi-Fi, чьи позиции известны в диапазоне работы вашего устройства. Поскольку у всех точек доступа имеются уникальные идентификационные адреса, называемые [[MAC-адрес |MAC-адресами]] (Media Access Control), можно получить достаточно хорошие приблизительные данные о местоположении, возможно, в пределах одной-двух улиц. Этот тип информации собирают машины просмотра улиц Google Street View Vehicles (от применения некоторых из них со временем пришлось отказаться из-за потенциального нарушения прав на соблюдение конфиденциальности данных).

Если и этой возможности не окажется, можно будет запросить IP-адрес вашего устройства и воспользоваться им как грубым индикатором вашего местоположения. Но чаще всего предоставляется место основного коммутатора, принадлежащего вашему Интернет-провайдеру, которое может быть удалено от вас на десятки и даже сотни километров. На самый крайний случай ваш [[IP-адрес]] может (в большинстве случаев) уточнить страну, а иногда и регион, в котором вы находитесь.

>[!info]
>IP-адреса часто применяются медиакомпаниями для территориальных ограничений по проигрыванию их контента. Но можно очень просто настроить прокси-серверы, использующие перенаправленный IP-адрес (на территории, которая блокирует доступ извне) для извлечения и передачи контента через блокаду непосредственно «иностранному» браузеру. Прокси-серверы также часто применяют для скрытия реального IP-адреса пользователя или для обхода цензурных ограничений. Они могут совместно применяться многими пользователями, к примеру, через точки подключения Wi-Fi. Поэтому если вы определили чье-то местонахождение по IP-адресу, нельзя быть абсолютно уверенными в идентификации правильного региона или даже страны и эту информацию нужно воспринимать только как предположение.


### Геолокация и HTML5
---

В [[Введение в HTML5|HTML5 немного базы]] я коротко описал имеющуюся в HTML5 геолокацию. Теперь настало время взглянуть на нее пристальнее, как показано в **примере 28.1.**

>**Пример 28.1.** Вывод карты с учетом местоположения пользователя
```html
<!DOCTYPE html>
<html> <!-- geolocation.html -->
  <head>
    <title>Geolocation Example</title>
  </head>
  <body>
    <script>
      if (typeof navigator.geolocation == 'undefined')
         alert("Geolocation not supported.")
      else
        navigator.geolocation.getCurrentPosition(granted, denied)

      function granted(position)
      {
        var lat = position.coords.latitude
        var lon = position.coords.longitude
        
        alert("Permission Granted. You are at location:\n\n"
          + lat + ", " + lon +
          "\n\nClick 'OK' to load Google Maps with your location")

        window.location.replace("https://www.google.com/maps/@"
          + lat + "," + lon + ",8z")
      }

      function denied(error)
      {
        var message

        switch(error.code)
        {
          case 1: message = 'Permission Denied'; break;
          case 2: message = 'Position Unavailable'; break;
          case 3: message = 'Operation Timed Out'; break;
          case 4: message = 'Unknown Error'; break;
        }

        alert("Geolocation Error: " + message)
      }
    </script>
  </body>
</html>
```

Пройдемся по этому коду и посмотрим, как он работает, начиная с раздела **`<head>`**, в котором выводится заголовок. Раздел документа **`<body>`** составлен полностью из кода JavaScript, который тут же запускается с исследования свойства **`navigator.geolocation`**. Если возвращается значение **`undefined`**, то геолокация браузером не поддерживается и появляется окно предупреждения об ошибке.

В противном случае вызывается метод **`getCurrentPosition`**, которому передаются имена двух функций: **`granted`** и **`denied`** ==(не забывайте, что, передавая только лишь имена функций, мы передаем реальный код функции, а не результат ее вызова, который передавался бы в том случае, если бы к именам функций примыкали скобки):==
```js
navigator.geolocation.getCurrentPosition(granted, denied)
```

Эти функции появляются в сценарии чуть позже и предназначены для обработки двух возможных вариантов разрешения на предоставление данных о местоположении: разрешено (**`granted`**) или отказано (**`denied`**).

Первой следует функция **`granted`**, и вход в нее осуществляется, только если к данным может быть получен доступ. В таком случае переменным **`lat`** и **`lon`** присваиваются значения, возвращаемые выполняемыми в браузере процедурами геолокации.

Затем появляется окно уведомления со сведениями о текущем местоположении пользователя. Когда пользователь нажимает кнопку **`OK`**, окно уведомления закрывается, и текущая веб-страница заменяется страницей одной из карт Google Maps. Этой странице передаются широта и долгота, возвращенные из вызова геолокации, и для нее используется увеличение поля видимости (zoom) с установленным значением **`8`**. Можно задать другой уровень увеличения, изменив в конце вызова **`window.location.replace`** значение **`8z`** на другое числовое значение, заканчивающееся буквой **`z`**.

Вывод на экран карты достигается вызовом метода **`window.location.replace`**. Результат показан на **рис. 28.1.**

>![[Рис. 28.1. Интерактивная карта, выведенная с учетом местоположения пользователя.jpg]]
>**Рис. 28.1.** Интерактивная карта, выведенная с учетом местоположения пользователя

Если в разрешении отказано (или возникла другая проблема), функцией `denied` будет выведено сообщение об ошибке, для чего ею будет показано свое собственное окно уведомления, информирующее пользователя о возникшей ошибке:

```js
switch(error.code)
{
  case 1: message = 'Permission Denied'; break;
  case 2: message = 'Position Unavailable'; break;
  case 3: message = 'Operation Timed Out'; break;
  case 4: message = 'Unknown Error'; break;
}

alert("Geolocation Error: " + message)
```

В предыдущих редакциях этой книги для встраивания карты непосредственно в веб-страницу использовалось обращение к Google Maps API, но теперь этот сервис требует от вас самих предоставления уникального ключа API, и для пользования сервисом в определенном объеме требуется оплата. Поэтому теперь в примере просто создается ссылка на Google Maps. Если же требуется вставить Google Maps в ваши веб-страницы или веб-приложения, все необходимые сведения можно найти на сайте https://developers.google.com/maps/. Разумеется, существует также множество других инструментальных средств вывода карт на страницу, например Bing Maps (https://www.bing.com/maps) и OpenStreetMap (https://www.openstreetmap.org), у которых имеются доступные вам API.

>[!info]
>Когда браузер запрашивает у хоста данные геолокации, он спрашивает разрешение у пользователя, которое тот может дать или не дать. Отказ приводит к состоянию «Доступ запрещен», когда же пользователь дал разрешение, но хост-система не в состоянии определить его местонахождение, возникает состояние «Позиция недоступна», а когда есть разрешение пользователя и хост пытается получить его позицию, но время выполнения запроса истекает, складывается ситуация «Время ожидания операции истекло».
>
>Существует еще одно условие возникновения ошибки, при котором разные сочетания платформ и браузеров позволяют пользователю отклонить диалог запроса разрешения без предоставления этого разрешения или отказа в его предоставлении, в результате чего приложение на время ожидания обратного вызова «зависает».


## Локальное хранилище
---

Cookie являются неотъемлемой частью современного интернета, потому что позволяют сайтам сохранять на каждой пользовательской машине небольшие фрагменты информации, которые могут применяться для отслеживания действий пользователя. Теперь это не воспринимается столь же зловеще, как звучит, поскольку в большинстве случаев проводимое отслеживание помогает пользователям, сохраняя имена и пароли, избавляться от необходимости регистрироваться на сайтах и в таких социальных сетях, как Twitter, Facebook и т. д.

Cookie позволяют также сохранять на локальной машине ваши предпочтения при обращении к сайту (вместо того, чтобы хранить эти предпочтения на сервере сайта) или могут использоваться для отслеживания наполнения товарной корзины при формировании заказа на сайте электронной торговли.

Конечно, они также могут использоваться более агрессивно — для отслеживания того, какие сайты посещаются чаще всего, составляя представление о ваших интересах, что позволит эффективнее направлять рекламу. Вот почему Европейский союз ввел положение о том, что «требуется предварительное информированное согласие на хранение информации, расположенной на конечном оборудовании пользователя, или на доступ к такой информации» (http://ec.europa.eu/ipg/basics/legal/cookies/index_en.htm).

Теперь подумайте с точки зрения веб-разработчика, насколько полезно может быть хранение данных на пользовательских устройствах, особенно если у вас небольшой ресурс компьютерных серверов и дискового пространства. Например, можно создавать браузерные веб-приложения и службы для редактирования текстовых документов, электронных таблиц и графических изображений, сохраняя все данные удаленно на пользовательских компьютерах, выдерживая закупочный бюджет своего сервера как можно ниже.

С пользовательской точки зрения подумайте, насколько быстрее может загружаться документ локально по сравнению с загрузкой из интернета, особенно при медленном подключении. Кроме того, вам будет намного спокойнее, если вы будете знать, что на сайте не хранятся копии ваших документов. Разумеется, полную безопасность сайта или веб-приложения гарантировать невозможно, и вы никогда не будете работать над сугубо конфиденциальными документами, используя программы (или оборудование), которые могут входить в Сеть.

В отношении документов, носящих сугубо личный характер, таких как семейные фотографии, возможно, будет комфортнее пользоваться веб-приложением, которое хранит данные локально, а не на внешнем сервере.


### Использование локального хранилища
---

Самая большая проблема при использовании [[cookie]] заключается в том, что в каждом из них можно хранить максимум 4 Кбайт данных. Cookie также должны курсировать в обоих направлениях при каждой перезагрузке страницы. И, если только ваш сервер не использует шифрование на уровне передачи данных [[TLS (Transport Layer Security)|Transport Layer Security (TLS)]], являющееся более безопасным потомком [[SSL (Secure Sockets Layer)|SSL-шифрования (Secure Sockets Layer)]], при каждой передаче cookie путешествуют в открытом виде.

Но с появлением HTML5 у вас появляется доступ к намного более объемному локальному хранилищу (обычно, в зависимости от браузера, между 5 и 10 Мбайт на каждый домен), которое сохраняет информацию между загрузками страницы и посещениями сайта (даже после выключения и включения компьютера). Кроме того, данные локального хранилища не отправляются на сервер при каждой загрузке страницы, и он может быть очищен пользователем, ведь, как правило, вы хотите сохранить данные и на серверах, иначе пользователь может обнаружить, что его данные исчезли, и расстроиться, даже если он очистил данные сам.

Эти данные хранятся в парах «ключ — значение». Ключ является именем, присваиваемым для ссылки на данные, а значение может содержать любой тип данных, но сохраняется в виде строки. Все данные для текущего домена уникальны, и из соображений безопасности любое локальное хранилище, созданное сайтами из других доменов, обособляется от текущего локального хранилища, которое становится недоступным любому домену, отличающемуся от того, что сохраняет данные.


#### Объект **`localStorage`**
---

==Доступ к локальному хранилищу можно получить с помощью объекта ==`localStorage`. Чтобы проверить доступность этого объекта, запрашивается его тип, позволяющий понять, был ли он определен:

```js
if (typeof localStorage == 'undefined') {
  // Локальное хранилище недоступно, нужно сообщить об этом          // пользователю и завершить работу. Или же вместо этого            // предложить сохранить данные на веб-сервере?
}
```

Можно ли обойтись без доступа к локальному хранилищу, будет зависеть от предполагаемых целей его использования, поэтому код, помещаемый в инструкцию **`if`**, зависит от вас.

Убедившись в доступности локального хранилища, можно приступить к его использованию с помощью методов **`setItem`** и **`getItem`** объекта **`localStorage`**:

```js
localStorage.setItem('loc', 'USA')
localStorage.setItem('lan', 'English')
```

Чтобы впоследствии просмотреть эти данные, необходимо передать ключ методу **`getItem`**:

```js
loc = localStorage.getItem('loc')
lan = localStorage.getItem('lan')
```

В отличие от сохранения и чтения cookie, эти методы можно вызвать в любое время, без необходимости предварительной отправки веб-сервером каких-нибудь заголовков. Сохраненные значения будут оставаться в локальном хранилище до тех пор, пока не будут уничтожены следующим образом:

```js
localStorage.removeItem('loc')
localStorage.removeItem('lan')
```

Или же можно полностью уничтожить локальное хранилище для текущего домена, вызвав метод **`clear`**:

```js
localStorage.clear()
```

В **примере 28.2** предыдущие примеры объединены в один документ, показывающий текущие значения двух ключей в появляющемся окне предупреждения, которое изначально будет иметь значение **`null`**. Затем ключи и значения сохраняются в локальном хранилище, извлекаются из него и заново показываются, на этот раз имея присвоенные значения. И наконец, ключи удаляются, а затем предпринимается попытка повторного извлечения значений, но возвращаемые значения снова равны **`null`**.

Второе из этих предупреждений продемонстрировано на **рис. 28.2.**

---
title: Cypher
date of creation: 2025-10-15T22:20:00
tags:
  - Graph
  - Neo4j
  - Graphs
  - SQL
  - DeclarativeLanguage
  - IT/ProgrammingLanguage
  - Cypher
read status: true
completion status: true
aliases:
  - Язык запросов Cypher
---
# Cypher
---

**Cypher** — ==декларативный язык запросов для графов свойств, созданный для графовой базы данных [[Neo4j]](он получил название в честь персонажа фильма «Матрица» и не имеет никакого отношения к криптографическим шифрам).==

Пример 2.3 демонстрирует запрос на языке Cypher, предназначенный для вставки левой части рис. 2.5 в графовую базу данных. Оставшуюся часть графа можно вставить аналогично, поэтому я опустил ее ради удобства чтения. Каждой вершине дано условное название, например `USA` или `Idaho`. Остальные части запроса могут использовать эти названия для создания ребер между вершинами с помощью стрелочной нотации: команда `(Idaho) -[:WITHIN]-> (USA)` создает ребро с меткой `WITHIN`, с начальной вершиной `Idaho` и конечной вершиной `USA`.

>*Пример 2.3. Подмножество данных с рис. 2.5, представленное в виде запроса Cypher*
```Cypher
CREATE
  (NAmerica:Location {name:'North America', type:'continent'}),     (USA:Location {name:'United States', type:'country'}),            (Idaho:Location {name:'Idaho', type:'state'}),
  (Lucy:Person {name:'Lucy' }),
  (Idaho) -[:WITHIN]-> (USA) -[:WITHIN]-> (NAmerica),
  (Lucy) -[:BORN_IN]-> (Idaho)
```

После вставки всех вершин и ребер рис. 2.5 в базу данных можно начать задавать интересные вопросы: например, найти имена всех людей, эмигрировавших из США в Европу. Точнее, нам нужно найти все вершины, ребро которых `BORN_IN` указывает на географический пункт, расположенный в США, а ребро `LIVING_IN` — на расположенный в Европе, и вернуть свойство name всех этих вершин.

В примере 2.4 показано, как выразить этот запрос на языке Cypher. Для поиска заданных шаблонов в графе используется та же стрелочная нотация в предложении `MATCH: (person) -[:BORN_IN]-> ()` найдет любые две вершины, относящиеся к ребру с меткой `BORN_IN`. Начальная вершина данного ребра привязана к переменной `person`, а конечная оставлена безымянной.

>*Пример 2.4. Запрос Cypher для поиска людей, эмигрировавших из США в Европу*
```Cypher
MATCH
  (person) -[:BORN_IN]-> () -[:WITHIN*0..]-> (us:Location 
  {name:'United States'}),
  (person) -[:LIVES_IN]-> () -[:WITHIN*0..]-> (eu:Location 
  {name: 'Europe'})
RETURN person.name
```

Этот запрос расшифровывается следующим образом.

1. Найти все вершины (назовем их `person`), удовлетворяющие обоим условиям.
	- У вершины person имеется исходящее ребро `BORN_IN` к какой-либо вершине. Из этой вершины можно построить цепочку исходящих ребер `WITHIN` вплоть до достижения вершины типа `Location`, свойство name которой равно `"United States"`.
	- У той же вершины person имеется исходящее ребро `LIVES_IN`. Следуя по данному ребру, а затем по цепочке исходящих ребер `WITHIN`, можно в конце концов достичь вершины типа `Location`, свойство name которой равно `"Europe"`.
2. Вернуть свойство `name` для каждой подобной вершины `person`.


> Источник — [[Высоконагруженные приложения. Программирование, масштабирование, поддержка]]
